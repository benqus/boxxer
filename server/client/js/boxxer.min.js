"undefined"==typeof Object.keys&&(Object.keys=function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return c}),"undefined"==typeof Object.prototype.hasOwnProperty&&(Object.prototype.hasOwnProperty=function(a){return this[a]&&!this.constructor.prototype[a]}),"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){if("function"!=typeof this)throw new TypeError("Object #<Object> has no method 'bind'");var a=Array.prototype.slice(arguments),b=a.shift(),c=this;return function(){return c.apply(b,a.concat(Array.prototype.slice.call(arguments)))}}),"function"!=typeof Array.prototype.indexOf&&(Array.prototype.indexOf=function(a){for(var b=0,c=this.length;c>b;b++)if(a===this[b])return b;return-1}),function(_g){function Surrogate(){}function debugMode(){return _g.boxxer_debug===!0}function getEventTarget(a){return a.target||a.srcElement}function getBody(){return document.body}function init(a){(a||getBody()).appendChild(renderer)}function getRenderer(){return renderer}function inherit(subClass,superClass){var TemporarySuperClass=function(){};debugMode()&&eval("TemporarySuperClass = function "+subClass.name+"() {};"),TemporarySuperClass.prototype=superClass.prototype,subClass.prototype=new TemporarySuperClass,subClass.prototype.constructor=subClass}function mix(a,b){var c;for(c in b.prototype)b.prototype.hasOwnProperty(c)&&(a.prototype[c]=b.prototype[c])}function register(a,b,c,d){for(var e,f=a.split("."),g=d||boxxer;f.length>0;)e=f.shift(),e&&(g.hasOwnProperty(e)||(g[e]={}),g=g[e]);g[b]="function"==typeof c?c(d||this,g):c}function patch(a,b,c){var d,e=a.split("."),f=c||boxxer;if("function"==typeof b){for(;e.length>0&&f;)d=e.shift(),d&&(f.hasOwnProperty(d)||(f[d]={}),f=f[d]);b(f)}}var boxxer={},renderer=document.createElement("div");renderer.style.display="none",boxxer.register=register,boxxer.Surrogate=Surrogate,boxxer.mix=mix,boxxer.inherit=inherit,boxxer.debugMode=debugMode,boxxer.utils={getBody:getBody,getRenderer:getRenderer,getEventTarget:getEventTarget},debugMode()&&(boxxer.utils.patch=patch),boxxer.init=init,_g.boxxer=boxxer}(window),boxxer.register("view","ViewContainer",function(a){return ViewContainer=function(a){this.box=a},ViewContainer.prototype.render=function(){},ViewContainer.prototype.serialize=function(){return'""'},a.view.View=ViewContainer}),boxxer.register("","Dialog",function(a){function b(a,b,c){var d=document.createElement("div");d.style.position="absolute",this.element=d,this.view=a,this.width=0,this.height=0,this.openContext=c||this,this.openCallback=b}return b.prototype.open=function(a,b,c){var d,e=this.element,f=(a||this.view).render(e);e.style.width=(this.width||b)+"px",e.style.height=(this.height||c)+"px","function"==typeof this.openCallback&&this.openCallback.call(this.openContext||this,this),f&&(f instanceof Node?e.appendChild(f):"string"==typeof f&&(d=document.createElement("div"),d.innerHTML=f,e.appendChild(d.firstElementChild)))},a.Dialog=b}),boxxer.register("decorator","Decorator",function(a){function b(){}return b.prototype.engage=function(){return this},b.prototype.getTemplate=function(){return document.createElement("div")},b.registry={},b.isRegistered=function(a){return b.registry.hasOwnProperty(a)},b.getDecorator=function(a){return b.registry[a]},b.extend=function(a){var c,d=new b;for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);return d},b.register=function(a,c){var d,e=b.registry;return""===a||e.hasOwnProperty(a)||(d=b.extend(c),e[a]=d),d},a.decorator.Decorator=b,a.createDecorator=b.register,b}),boxxer.register("mixins","Adjustable",function(a){function b(){}return b.prototype.getWidth=function(){return this.width},b.prototype.getHeight=function(){return this.height},b.prototype.setWidth=function(a){this._setElementWidth(parseInt(a))},b.prototype.setHeight=function(a){this._setElementHeight(parseInt(a))},b.prototype.setDimensions=function(a,b){this.setWidth(a),this.setHeight(b)},a.mixins.Adjustable=b,b}),boxxer.register("mixins","ElementWrapper",function(a){function b(){this._element=document.createElement("div")}return b.prototype._setElementWidth=function(a){this.getElement().style.width=a+"px"},b.prototype._setElementHeight=function(a){this.getElement().style.height=a+"px"},b.prototype.getElement=function(){return this._element},b.prototype.addClass=function(a){var b=this.getElement().getAttribute("class"),c=b?b.split(" "):[];c.indexOf(a)<0&&(c.push(a),this.getElement().setAttribute("class",c.join(" ")))},b.prototype.hasClass=function(a){return this.getElement().getAttribute("class").indexOf(a)>-1},b.prototype.getAttribute=function(a){return this.getElement().getAttribute(a)||""},b.prototype.setAttribute=function(a,b){this.getElement().setAttribute(a,(b||"").toString())},b.prototype.getDataAttribute=function(a){return this.getElement().getAttribute("data-"+a)},b.prototype.setDataAttribute=function(a,b){this.getElement().setAttribute("data-"+a,b)},b.prototype.text=function(a){var b=this.getElement();return"string"!=typeof a?b.innerText:(b.innerText=a,void 0)},b.prototype.html=function(a){var b=this.getElement();return"string"!=typeof a?b.innerHTML:(b.innerHTML=a,void 0)},a.mixins.ElementWrapper=b,b}),boxxer.register("mixins","ParentElementWrapper",function(a){function b(a){this._parentElement=a}return b.prototype.getParentElement=function(){return this._parentElement||a.utils.getBody()},b.prototype.setParentElement=function(a){var b=this.getElement();b.parentElement!==a&&this._parentElement!==a&&(this._parentElement=a,this._parentElement.appendChild(b))},a.mixins.ParentElementWrapper=b,b}),boxxer.register("mixins","Serializer",function(a){function b(){}return b.prototype.serialize=function(a,c){var d;return d=a===b.JSON?b.toJSON(this,c):b.toXML(this,c)},b.toJSON=function(c,d){var e,f,g=c.view,h=c.getChildCount(),i=c.getDecorators(),j='{"id":'+Number(c.getId().replace("boxxer:box_",""))+","+'"flow":"'+c.getFlowDirection()+'",'+b.getJSONAttributes(c);if("string"==typeof d&&""!==d&&(j+=',"name":"'+d+'"'),i.length>0&&(j+=',"decorators":[',j+=i.join(","),j+="]"),h>0){j+=',"children":[',f=c.getChildren();for(e in f)f.hasOwnProperty(e)&&(j+=f[e].serialize(b.JSON,e),h--,h>0&&(j+=","));j+="]"}return g instanceof a.view.View&&(j+=", view:"+g.serialize()),j+="}"},b.toXML=function(a,c){var d,e,f=a.getDecorators(),g="<boxxer:box id='"+Number(a.getId().replace("boxxer:box_",""))+"'"+" flow='"+a.getFlowDirection()+"'";if("string"==typeof c&&""!==c&&(g+=" name='"+c+"'"),g+=b.getXMLAttributes(a)+">",f.length>0&&(g+=" decorators='",g+=f.join(","),g+="'"),a.getChildCount()){e=a.getChildren();for(d in e)e.hasOwnProperty(d)&&(g+=e[d].serialize(b.XML,d))}return g+="</boxxer:box>"},b.getJSONAttributes=function(a){return'"width":'+a.getWidth().getValue()+","+'"height":'+a.getHeight().getValue()},b.getXMLAttributes=function(a){return" width='"+a.getWidth().getValue()+"' "+"height='"+a.getHeight().getValue()+"'"},b.deserialize=function(a){var c,d,e,f,g;try{e=JSON.parse(a),e instanceof Object&&(g=b.JSON,f=e)}catch(h){c=document.createElement("div"),c.innerHTML=a,d=c.firstElementChild||c.children[0],(d&&"boxxer:box"===d.tagName.toLowerCase()||"boxxer"===d.scopeName&&"box"===d.tagName)&&(g=b.XML,f=d)}return void 0!==f&&(f=b.buildHierarchy(f,g)),f},b.buildHierarchy=function(c,d){var e,f,g,h,i;if(d===b.JSON){if(e=new a.Box,e.setFlowDirection(c.flow),c.width&&e.setWidth(c.width),c.height&&e.setHeight(c.height),c.decorators)for(g=c.decorator.replace(" ","").split(",");g.length>0;)e.addDecorator(g.shift());if(c.children&&c.children.length>0)for(i=0;i<c.children.length;i++)h=c.children[i],f=e.addBox(b.buildHierarchy(h,d),h.name)}else if(d===b.XML){if(e=new a.Box,c.getAttribute("flow")&&e.setFlowDirection(c.getAttribute("flow")),c.getAttribute("width")&&e.setWidthDimension(c.getAttribute("width")),c.getAttribute("height")&&e.setHeightDimension(c.getAttribute("height")),c.getAttribute("decorators"))for(g=c.getAttribute("decorators").replace(" ","").split(",");g.length>0;)e.addDecorator(g.shift());if(c.children&&c.children.length)for(i=0;i<c.children.length;i++)h=c.children[i],f=e.addBox(b.buildHierarchy(h,d),h.getAttribute("name"))}return e},b.XML="xml",b.JSON="json",a.mixins.Serializer=b,b}),boxxer.register("async","Connection",function(a){function b(a,b){this._url=a,this._data=b.data||"",this._callback=b.callback,this._request=new XMLHttpRequest}return b.prototype.onStateChange=function(){var a,b=this._request;"function"==typeof this._callback&&4===b.readyState&&200===b.status&&(a=Array.prototype.slice(arguments),a.unshift(b,b.responseText),this._callback.apply(null,a))},b.prototype.save=function(){this._request.onreadystatechange=this.onStateChange.bind(this),this._request.open(b.POST,this._url,!0),this._request.send(this._data)},b.prototype.create=function(){this._request.onreadystatechange=this.onStateChange.bind(this),this._request.open(b.PUT,this._url,!0),this._request.send(this._data)},b.prototype.remove=function(){this._request.onreadystatechange=this.onStateChange.bind(this),this._request.open(b.DELETE,this._url,!0),this._request.send()},b.prototype.get=function(){this._request.onreadystatechange=this.onStateChange.bind(this),this._request.open(b.GET,this._url,!0),this._request.send()},b.PUT="PUT",b.DELETE="DELETE",b.POST="POST",b.GET="GET",a.async.Connection=b,b}),boxxer.register("layouts","Layout",function(a){function b(){}return b.prototype.getLayout=function(){var c=function(b){var b=JSON.parse(b.responseText),c=b.layout,d=a.mixins.Serializer.deserialize(c);this.addBox(d)}.bind(this);new a.async.Connection(b.URL+"/"+this.getId(),{callback:c}).get()},b.prototype.saveLayout=function(c){var d=this.serialize(a.mixins.Serializer.JSON,c||null);new a.async.Connection(b.URL+"/"+this.getId(),{data:d}).save()},b.prototype.deleteLayout=function(){new a.async.Connection(b.URL+this.getId()).remove()},b.URL=window.location.href+"/layout",a.layouts.Layout=b,b}),boxxer.register("events","BoxEvent",function(a){function b(a,c,d){this._eventType=a,this._callback=c,this._context=d,this._muted=!1,this._id="event_"+b._id++}return b.prototype.execute=function(){if(!this.isMuted()){var a=Array.prototype.slice.call(arguments);a.unshift(this.getEventType()),this._callback.apply(this._context,a)}},b.prototype.getId=function(){return this._id},b.prototype.getEventType=function(){return this._eventType},b.prototype.mute=function(){this._muted=!0},b.prototype.unmute=function(){this._muted=!1},b.prototype.isMuted=function(){return this._muted},b._id=0,a.events.BoxEvent=b,b}),boxxer.register("events","EventEmitter",function(a){function b(){this._eventTypes={},this._mutedTypes={}}return b.prototype._createEventType=function(a){return this._eventTypes.hasOwnProperty(a)||(this._eventTypes[a]={}),this._eventTypes[a]},b.prototype.on=function(b,c,d){var e=new a.events.BoxEvent(b,c,d||this);return this._createEventType(b)[e.getId()]=e,e},b.prototype.off=function(b){if(!(b instanceof a.events.BoxEvent))throw new TypeError("Cannot un-register a non-Event type object...");delete this._eventTypes[b.getEventType()][b.getId()]},b.prototype.mute=function(a){this._mutedTypes[a]=!0},b.prototype.unmute=function(a){delete this._mutedTypes[a]},b.prototype.isMuted=function(a){return this._mutedTypes.hasOwnProperty(a)},b.prototype.emit=function(){var a,b,c=Array.prototype.slice.call(arguments),d=c.shift(),e=this._eventTypes[d];if(!this.isMuted(d))for(b in e)e.hasOwnProperty(b)&&(a=e[b],a.execute.apply(a,c))},b.ON_RENDER="render",b.ON_UPDATE="update",a.events.EventEmitter=b,b}),boxxer.register("render","Dimension",function(a){function b(c){var d=this._parse(c),e=parseInt(d.value);switch(this._minValue=a.Box.MIN_DIMENSION,this._value=e?e:1,this._type=void 0,d.type){case"%":this._type=b.PERCENT;break;case"px":this._type=b.PIXEL;break;default:this._type=b.WEIGHT}}return b.prototype._parse=function(a){var b=(a||"").toString().split(/(\%|px)/);return{value:b[0],type:b[1]}},b.prototype.getType=function(){return this._type},b.prototype.getMinimumValue=function(){return this._minValue},b.prototype.getValue=function(){return this._value},b.prototype.calculate=function(a,c){var d=this.getType(),e=this.getValue(),f=5,g=parseInt(this._parse(this.getMinimumValue()).value),h=e;if(f>=a&&d===b.WEIGHT)h=0;else{switch(d){case b.PERCENT:h=a*(e/100);break;case b.WEIGHT:e>c&&(e=c),h=a/c*e}g>h&&(h=g)}return Math.floor(h)},b.PERCENT="percent",b.WEIGHT="weight",b.DEFAULT_WEIGHT=1,b.PIXEL="pixel",a.render.Dimension=b,b}),boxxer.register("","Box",function(a){function b(c,e,f){d.ElementWrapper.call(this),d.ParentElementWrapper.call(this,f),a.events.EventEmitter.call(this),this._id=b.generateUniqueBoxId(),this._children={},this.view=void 0,this.width=new a.render.Dimension(c),this.height=new a.render.Dimension(e),this._decorators=[],this._flowDirection=b.FLOW_VERTICAL,this.isRendered=!1,this.addClass("boxxer-Box"),this.setDataAttribute("box-id",this.getId()),b._registry[this.getId()]=this}var c="boxxer:box_",d=a.mixins;return a.mix(b,d.Adjustable),a.mix(b,d.ElementWrapper),a.mix(b,d.ParentElementWrapper),a.mix(b,a.layouts.Layout),a.mix(b,d.Serializer),a.mix(b,a.events.EventEmitter),b.prototype.addDecorator=function(a){return this._decorators.push(a),this},b.prototype.getDecorators=function(){return this._decorators},b.prototype.getFlowDirection=function(){return this._flowDirection},b.prototype.setFlowDirection=function(a){this._flowDirection=a},b.prototype.setWidthDimension=function(b){this.width=new a.render.Dimension(b)},b.prototype.setHeightDimension=function(b){this.height=new a.render.Dimension(b)},b.prototype.addChild=function(a,c,d){var e=new b(a,c,this.getElement());return this.addBox(e,d)},b.prototype.addBox=function(a,c){if(!(a instanceof b))throw new TypeError("Argument is not a Box!");return a.setParentElement(this.getElement()),this.getChildren()[c||a.getId()]=a,a},b.prototype.getId=function(){return this._id},b.prototype.getChild=function(a){return this.getChildren()[a]},b.prototype.getChildren=function(){return this._children},b.prototype.getChildCount=function(){return Object.keys(this.getChildren()).length},b.prototype.removeChild=function(a){var b=this.getChildren();b[a].close(),delete b[a]},b.prototype.render=function(){var c,d=this.getParentElement(),e=d.getAttribute("data-box-id"),f=b.getById(e),g=a.events.EventEmitter.ON_RENDER;f instanceof b&&(c=f.getFlowDirection()),a.render.BoxRenderer.render(this,d,c),this.isRendered?g=a.events.EventEmitter.ON_UPDATE:this.isRendered=!0,this.emit(g)},b.MIN_DIMENSION="100px",b.FLOW_VERTICAL="verticalFlow",b.FLOW_HORIZONTAL="horizontalFlow",b._registry={},b._id=0,b.generateUniqueBoxId=function(){return c+b._id++},b.removeBox=function(a){delete b._registry[a]},b.getById=function(a){return b._registry[a]},b.clean=function(){b._id=0,b._registry={}},a.Box=b,b}),boxxer.register("render","BoxRenderer",function(a){function b(){}var c=a.Box,d=a.decorator.Decorator,e=c.FLOW_HORIZONTAL,f=c.FLOW_VERTICAL;return b.prototype.setElementInline=function(a){a.style.display="inline-block",a.style.verticalAlign="top"},b.prototype.render=function(b,c,d){if(!(b instanceof a.Box))throw new TypeError("Invalid argument - not a box!");var e=b.getElement(),f=b.view;"undefined"==typeof d||"undefined"==typeof c?(c=b.getParentElement(),d=b.getFlowDirection(),d===a.Box.FLOW_HORIZONTAL&&this.setElementInline(e),b.setDimensions(c.offsetWidth,c.offsetHeight)):d===a.Box.FLOW_HORIZONTAL&&this.setElementInline(e),e.parentNode!==c&&(e.parentNode&&e.parentNode.removeChild(e),c.appendChild(e)),b.isRendered||this._applyDecorators(b),this._postRender(b,f,e,d)},b.prototype._applyDecorators=function(a){for(var b,c,e=a.getDecorators(),f=e.length,g=0;f>g;g++)b=d.getDecorator(e[g]),c=b.getTemplate(a),b.engage(a,c);return this},b.prototype._postRender=function(b,c,d,e){var f,g;b.getChildCount()&&this._renderChildren(b,d,e),c instanceof a.view.View&&(f=c.render(d),f&&(f instanceof Node?d.appendChild(f):"string"==typeof f&&(g=document.createElement("div"),g.innerHTML=f,d.appendChild(g.firstElementChild))))},b.prototype.resolveAndSortChildren=function(b,c,d){var g,h,i,j=[],k=d===e,l=k?"width":"height",m=c["offset"+(k?"Width":"Height")],n=b.getChildren(),o={},p={},q={},r=0,s=0,t=0;for(i in n)if(n.hasOwnProperty(i)){switch(h=n[i],g=h[l],g.getType()){case a.render.Dimension.PERCENT:p[i]=h,r+=Math.floor(m*(g.getValue()/100));break;case a.render.Dimension.PIXEL:o[i]=h,s+=g.getValue();break;default:q[i]=h,t+=g.getValue()}j.push(i)}return{order:j,method:d===f?"Width":"Height",dimension:d===e?"Width":"Height",pixelBoxes:o,percentBoxes:p,weightBoxes:q,percents:r,weights:t,pixels:s}},b.prototype._renderChildren=function(b,c,d){var f,g,h,i,j,k,l,m,n,o=this.resolveAndSortChildren(b,c,d),p=b.getChildren(),q=o.order,r=a.render.Dimension.WEIGHT;for(d===e?(f=c.offsetHeight,g=c.offsetWidth):(f=c.offsetWidth,g=c.offsetHeight),i=g-o.percents-o.pixels;q.length>0;)n=p[q.shift()],j=n.width,k=n.height,d===e?(h=j.getType(),l=j.calculate(h===r?i:g,o.weights),m=k.calculate(f,1)):(h=k.getType(),l=j.calculate(f,1),m=k.calculate(h===r?i:g,o.weights)),n.setDimensions(l,m),n.render()},a.render.BoxRenderer=b,new b}),boxxer.createDecorator("DragDecorator",{engage:function(){}}),boxxer.createDecorator("DropDecorator",{engage:function(){}}),boxxer.createDecorator("HeaderDecorator",{engage:function(a,b){var c=a.getElement();c.style.position="relative",c.appendChild(b),console.log(c)},getTemplate:function(a){var b=(document.createElement("h5"),document.createElement("header"));return b.setAttribute("class","HeaderDecorator"),b.innerHTML=a.getId(),b.style.position="absolute",b.style.left="0px",b.style.top="0px",b}}),boxxer.register("decorator","Decorator",function(a){function b(){}return b.prototype.engage=function(){return this},b.prototype.getTemplate=function(){return document.createElement("div")},b.registry={},b.isRegistered=function(a){return b.registry.hasOwnProperty(a)},b.getDecorator=function(a){return b.registry[a]},b.extend=function(a){var c,d=new b;for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);return d},b.register=function(a,c){var d,e=b.registry;return""===a||e.hasOwnProperty(a)||(d=b.extend(c),e[a]=d),d},a.decorator.Decorator=b,a.createDecorator=b.register,b});