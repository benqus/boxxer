(function(){function Surrogate(){}function debugMode(){return global.boxxer_debug===!0}function getEventTarget(e){return e.target||e.srcElement}function getBody(){return document.body}function init(e){(e||getBody()).appendChild(renderer)}function getRenderer(){return renderer}function inherit(subClass,superClass){var TemporarySuperClass=function(){};debugMode()&&eval("TemporarySuperClass = function "+subClass.name+"() {};"),TemporarySuperClass.prototype=superClass.prototype,subClass.prototype=new TemporarySuperClass,subClass.prototype.constructor=subClass}function mix(e,t){var n;for(n in t.prototype)t.prototype.hasOwnProperty(n)&&(e.prototype[n]=t.prototype[n])}function Async(){}function Connection(e,t){this._url=e,this._data=t.data||"",this._callback=t.callback,this._request=new XMLHttpRequest}function Decorator(){}function BoxEvent(e,t,n){this._eventType=e,this._callback=t,this._context=n,this._muted=!1,this._id="event_"+BoxEvent._id++}function EventEmitter(){this._eventTypes={},this._mutedTypes={}}function Layout(){}function Manager(){}function Adjustable(){}function ElementWrapper(){this._element=document.createElement("div")}function ParentElementWrapper(e){this._parentElement=e}function Serializer(){}function Data(){this.url="/persist"}function BoxRenderer(){}function Dimension(e){var t=this._parse(e),n=parseInt(t.value);switch(this._minValue=Box.MIN_DIMENSION,this._value=n?n:1,this._type=void 0,t.type){case"%":this._type=Dimension.PERCENT;break;case"px":this._type=Dimension.PIXEL;break;default:this._type=Dimension.WEIGHT}}function ViewContainer(e){this.box=e}function Dialog(e,t,n){var r=document.createElement("div");r.style.position="absolute",this.element=r,this.view=e,this.width=0,this.height=0,this.openContext=n||this,this.openCallback=t}function Box(e,t,n){ElementWrapper.call(this),ParentElementWrapper.call(this,n),EventEmitter.call(this),this._id=Box.generateUniqueBoxId(),this._name=null,this._children={},this.view=void 0,this.width=new Dimension(e),this.height=new Dimension(t),this._decorators=[],this._flowDirection=Box.FLOW_VERTICAL,this.isRendered=!1,this.addClass("boxxer-Box"),this.setDataAttribute("box-id",this.getId()),Box._registry[this.getId()]=this}var global=this,exports={},_boxxer=global.boxxer,renderer=document.createElement("div");renderer.style.display="none",_boxxer&&(exports._boxxer=_boxxer),global.boxxer=exports,exports.Surrogate=Surrogate,exports.mix=mix,exports.inherit=inherit,exports.debugMode=debugMode,exports.utils={getBody:getBody,getRenderer:getRenderer,getEventTarget:getEventTarget},exports.init=init,exports.Async=Async,Async.prototype.save=function(e,t,n,r){return Async.saveBox(this,e,r,t,n)},Async.saveBox=function(e,t,n,r,i){i||(i=Serializer.JSON),new Connection(e,t,n,i,r).save()},Async.POST="PUT",Async.POST="DELETE",Async.POST="POST",Async.GET="GET",exports.Connection=Connection,Connection.prototype.onStateChange=function(){var e,t=this._request;"function"==typeof this._callback&&4===t.readyState&&200===t.status&&(e=Array.prototype.slice(arguments),e.unshift(t,t.responseText),this._callback.apply(null,e))},Connection.prototype.save=function(){this._request.onreadystatechange=this.onStateChange.bind(this),this._request.open(Connection.POST,this._url,!0),this._request.send(this._data)},Connection.prototype.create=function(){this._request.onreadystatechange=this.onStateChange.bind(this),this._request.open(Connection.PUT,this._url,!0),this._request.send(this._data)},Connection.prototype.remove=function(){this._request.onreadystatechange=this.onStateChange.bind(this),this._request.open(Connection.DELETE,this._url,!0),this._request.send()},Connection.prototype.get=function(){this._request.onreadystatechange=this.onStateChange.bind(this),this._request.open(Connection.GET,this._url,!0),this._request.send()},Connection.PUT="PUT",Connection.DELETE="DELETE",Connection.POST="POST",Connection.GET="GET",exports.Decorator=Decorator,Decorator.prototype.engage=function(){return this},Decorator.prototype.getTemplate=function(){return document.createElement("div")},Decorator.registry={},Decorator.isRegistered=function(e){return Decorator.registry.hasOwnProperty(e)},Decorator.getDecorator=function(e){return Decorator.registry[e]},Decorator.extend=function(e){var t,n=new Decorator;for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},Decorator.register=function(e,t){var n,r=Decorator.registry;return""===e||r.hasOwnProperty(e)||(n=Decorator.extend(t),r[e]=n),n},exports.createDecorator=Decorator.register,exports.BoxEvent=BoxEvent,BoxEvent.prototype.execute=function(){if(!this.isMuted()){var e=Array.prototype.slice.call(arguments);e.unshift(this.getEventType()),this._callback.apply(this._context,e)}},BoxEvent.prototype.getId=function(){return this._id},BoxEvent.prototype.getEventType=function(){return this._eventType},BoxEvent.prototype.mute=function(){this._muted=!0},BoxEvent.prototype.unmute=function(){this._muted=!1},BoxEvent.prototype.isMuted=function(){return this._muted},BoxEvent._id=0,exports.EventEmitter=EventEmitter,EventEmitter.prototype._createEventType=function(e){return this._eventTypes.hasOwnProperty(e)||(this._eventTypes[e]={}),this._eventTypes[e]},EventEmitter.prototype.on=function(e,t,n){var r=new BoxEvent(e,t,n||this);return this._createEventType(e)[r.getId()]=r,r},EventEmitter.prototype.off=function(e){if(!(e instanceof BoxEvent))throw new TypeError("Cannot un-register a non-Event type object...");delete this._eventTypes[e.getEventType()][e.getId()]},EventEmitter.prototype.mute=function(e){this._mutedTypes[e]=!0},EventEmitter.prototype.unmute=function(e){delete this._mutedTypes[e]},EventEmitter.prototype.isMuted=function(e){return this._mutedTypes.hasOwnProperty(e)},EventEmitter.prototype.emit=function(){var e,t,n=Array.prototype.slice.call(arguments),r=n.shift(),i=this._eventTypes[r];if(!this.isMuted(r))for(t in i)i.hasOwnProperty(t)&&(e=i[t],e.execute.apply(e,n))},EventEmitter.ON_RENDER="render",EventEmitter.ON_UPDATE="update",exports.Layout=Layout,Layout.prototype.getLayout=function(){var e=function(e){var t=JSON.parse(e.responseText),n=t.layout,r=Serializer.deserialize(n);this.addBox(r)}.bind(this);new Connection(Layout.URL+"/"+this.getId(),{callback:e}).get()},Layout.prototype.saveLayout=function(e){var t=this.serialize(Serializer.JSON,e||null);new Connection(Layout.URL+"/"+this.getId(),{data:t}).save()},Layout.prototype.deleteLayout=function(){new Connection(Layout.URL+this.getId()).remove()},Layout.URL=window.location.href+"/layout",exports.Manager=Manager,Manager.prototype.getLayouts=function(){new Connection(Layout.URL+"/"+this.getId(),{data:layout}).save()},Manager.URL="/layouts",exports.Adjustable=Adjustable,Adjustable.prototype.getWidth=function(){return this.width},Adjustable.prototype.getHeight=function(){return this.height},Adjustable.prototype.setWidth=function(e){this._setElementWidth(parseInt(e))},Adjustable.prototype.setHeight=function(e){this._setElementHeight(parseInt(e))},Adjustable.prototype.setDimensions=function(e,t){this.setWidth(e),this.setHeight(t)},exports.ElementWrapper=ElementWrapper,ElementWrapper.prototype._setElementWidth=function(e){this.getElement().style.width=e+"px"},ElementWrapper.prototype._setElementHeight=function(e){this.getElement().style.height=e+"px"},ElementWrapper.prototype.getElement=function(){return this._element},ElementWrapper.prototype.addClass=function(e){var t=this.getElement().getAttribute("class"),n=t?t.split(" "):[];0>n.indexOf(e)&&(n.push(e),this.getElement().setAttribute("class",n.join(" ")))},ElementWrapper.prototype.hasClass=function(e){return this.getElement().getAttribute("class").indexOf(e)>-1},ElementWrapper.prototype.getAttribute=function(e){return this.getElement().getAttribute(e)||""},ElementWrapper.prototype.setAttribute=function(e,t){this.getElement().setAttribute(e,""+(t||""))},ElementWrapper.prototype.getDataAttribute=function(e){return this.getElement().getAttribute("data-"+e)},ElementWrapper.prototype.setDataAttribute=function(e,t){this.getElement().setAttribute("data-"+e,t)},ElementWrapper.prototype.text=function(e){var t=this.getElement();return"string"!=typeof e?t.innerText:(t.innerText=e,void 0)},ElementWrapper.prototype.html=function(e){var t=this.getElement();return"string"!=typeof e?t.innerHTML:(t.innerHTML=e,void 0)},exports.ParentElementWrapper=ParentElementWrapper,ParentElementWrapper.prototype.getParentElement=function(){return this._parentElement||getBody()},ParentElementWrapper.prototype.setParentElement=function(e){var t=this.getElement();t.parentElement!==e&&this._parentElement!==e&&(this._parentElement=e,this._parentElement.appendChild(t))},exports.Serializer=Serializer,Serializer.prototype.serialize=function(e,t){var n;return n=e===Serializer.JSON?Serializer.toJSON(this,t):Serializer.toXML(this,t)},Serializer.toJSON=function(e,t){var n,r,i=e.view,o=e.getChildCount(),s=e.getDecorators(),a='{"id":'+Number(e.getId().replace("bbox_",""))+","+'"flow":"'+e.getFlowDirection()+'",'+Serializer.getJSONAttributes(e);if("string"==typeof t&&""!==t&&(a+=',"name":"'+t+'"'),s.length>0&&(a+=',"decorators":[',a+=s.join(","),a+="]"),o>0){a+=',"children":[',r=e.getChildren();for(n in r)r.hasOwnProperty(n)&&(a+=r[n].serialize(Serializer.JSON,n),o--,o>0&&(a+=","));a+="]"}return i instanceof ViewContainer&&(a+=", view:"+i.serialize()),a+="}"},Serializer.toXML=function(e,t){var n,r,i=e.getDecorators(),o="<bbox id='"+Number(e.getId().replace("bbox_",""))+"'"+" flow='"+e.getFlowDirection()+"'";if("string"==typeof t&&""!==t&&(o+=" name='"+t+"'"),o+=Serializer.getXMLAttributes(e)+">",i.length>0&&(o+=" decorators='",o+=i.join(","),o+="'"),e.getChildCount()){r=e.getChildren();for(n in r)r.hasOwnProperty(n)&&(o+=r[n].serialize(Serializer.XML,n))}return o+="</bbox>"},Serializer.getJSONAttributes=function(e){return'"width":'+e.getWidth().getSerializedValue()+","+'"height":'+e.getHeight().getSerializedValue()},Serializer.getXMLAttributes=function(e){return" width='"+e.getWidth().getSerializedValue()+"' "+"height='"+e.getHeight().getSerializedValue()+"'"},Serializer.deserialize=function(e){var t,n,r,i,o;try{r=JSON.parse(e),r instanceof Object&&(o=Serializer.JSON,i=r)}catch(s){t=document.createElement("div"),t.innerHTML=e,n=t.firstElementChild||t.children[0],n&&"bbox"===n.tagName.toLowerCase()&&(o=Serializer.XML,i=n)}return void 0!==i&&(i=Serializer.buildHierarchy(i,o)),i},Serializer.buildHierarchy=function(e,t){var n,r,i,o,s;if(t===Serializer.JSON){if(n=new Box,n.setFlowDirection(e.flow),n.setWidth(e.width),n.setHeight(e.height),e.decorators)for(i=e.decorator.replace(" ","").split(",");i.length>0;)n.addDecorator(i.shift());if(e.children&&e.children.length>0)for(s=0;e.children.length>s;s++)o=e.children[s],r=n.addBox(Serializer.buildHierarchy(o,t),o.name)}else if(t===Serializer.XML){if(n=new Box,n.setFlowDirection(e.getAttribute("flow")),n.setWidthDimension(e.getAttribute("width")),n.setHeightDimension(e.getAttribute("height")),e.getAttribute("decorators"))for(i=e.getAttribute("decorators").replace(" ","").split(",");i.length>0;)n.addDecorator(i.shift());if(e.children&&e.children.length)for(s=0;e.children.length>s;s++)o=e.children[s],r=n.addBox(Serializer.buildHierarchy(o,t),o.getAttribute("name"))}return n},Serializer.XML="xml",Serializer.JSON="json",exports.Data=Data,exports.BoxRenderer=BoxRenderer,BoxRenderer.setElementInline=function(e){e.style.display="inline-block",e.style.verticalAlign="top"},BoxRenderer.render=function(e,t,n){if(!(e instanceof Box))throw new TypeError("Invalid argument - not a box!");var r=e.getElement(),i=e.view;n===void 0||t===void 0?(t=e.getParentElement(),n=e.getFlowDirection(),n===Box.FLOW_HORIZONTAL&&BoxRenderer.setElementInline(r),e.setDimensions(t.offsetWidth,t.offsetHeight)):n===Box.FLOW_HORIZONTAL&&BoxRenderer.setElementInline(r),r.parentNode!==t&&(r.parentNode&&r.parentNode.removeChild(r),t.appendChild(r)),e.isRendered||BoxRenderer._applyDecorators(e),BoxRenderer._postRender(e,i,r,n)},BoxRenderer._applyDecorators=function(e){for(var t,n,r=e.getDecorators(),i=r.length,o=0;i>o;o++)t=Decorator.getDecorator(r[o]),n=t.getTemplate(e),t.engage(e,n)},BoxRenderer._postRender=function(e,t,n,r){var i,o;e.getChildCount()&&this._renderChildren(e,n,r),t instanceof ViewContainer&&(i=t.render(n),i&&(i instanceof Node?n.appendChild(i):"string"==typeof i&&(o=document.createElement("div"),o.innerHTML=i,n.appendChild(o.firstElementChild))))},BoxRenderer.resolveAndSortChildren=function(e,t,n){var r,i,o,s=[],a=n===Box.FLOW_HORIZONTAL,p=a?"width":"height",l=t["offset"+(a?"Width":"Height")],u=e.getChildren(),h={},c={},d={},g=0,y=0,f=0;for(o in u)if(u.hasOwnProperty(o)){switch(i=u[o],r=i[p],r.getType()){case Dimension.PERCENT:c[o]=i,g+=Math.floor(l*(r.getValue()/100));break;case Dimension.PIXEL:h[o]=i,y+=r.getValue();break;default:d[o]=i,f+=r.getValue()}s.push(o)}return{order:s,method:n===Box.FLOW_VERTICAL?"Width":"Height",dimension:n===Box.FLOW_HORIZONTAL?"Width":"Height",pixelBoxes:h,percentBoxes:c,weightBoxes:d,percents:g,weights:f,pixels:y}},BoxRenderer._renderChildren=function(e,t,n){var r,i,o,s,a,p,l,u,h,c=this.resolveAndSortChildren(e,t,n),d=e.getChildren(),g=c.order,y=Dimension.WEIGHT;for(n===Box.FLOW_HORIZONTAL?(r=t.offsetHeight,i=t.offsetWidth):(r=t.offsetWidth,i=t.offsetHeight),s=i-c.percents-c.pixels;g.length>0;)h=d[g.shift()],a=h.width,p=h.height,n===Box.FLOW_HORIZONTAL?(o=a.getType(),l=a.calculate(o===y?s:i,c.weights),u=p.calculate(r,1)):(o=p.getType(),l=a.calculate(r,1),u=p.calculate(o===y?s:i,c.weights)),h.setDimensions(l,u),h.render()},exports.Dimension=Dimension,Dimension.prototype._parse=function(e){var t=(""+(e||"")).split(/(\%|px)/);return{value:t[0],type:t[1]}},Dimension.prototype.getType=function(){return this._type||""},Dimension.prototype.getMinimumValue=function(){return this._minValue},Dimension.prototype.getValue=function(){return this._value},Dimension.prototype.calculate=function(e,t){var n=this.getType(),r=this.getValue(),i=5,o=parseInt(this._parse(this.getMinimumValue()).value),s=r;if(i>=e&&n===Dimension.WEIGHT)s=0;else{switch(n){case Dimension.PERCENT:s=e*(r/100);break;case Dimension.WEIGHT:r>t&&(r=t),s=e/t*r}o>s&&(s=o)}return Math.floor(s)},Dimension.prototype.getSerializedValue=function(){var e=this.getType(),t=this.getValue();return e!==Dimension.WEIGHT&&(t+=this.getType()),t},Dimension.PERCENT="%",Dimension.WEIGHT="weight",Dimension.DEFAULT_WEIGHT=1,Dimension.PIXEL="px",exports.ViewContainer=ViewContainer,ViewContainer.prototype.render=function(){},ViewContainer.prototype.serialize=function(){return'""'},boxxer.createDecorator("HeaderDecorator",{engage:function(e,t){var n=e.getElement();n.style.position="relative",n.appendChild(t),console.log(n)},getTemplate:function(e){var t=(document.createElement("h5"),document.createElement("header"));return t.setAttribute("class","HeaderDecorator"),t.innerHTML=e.getId(),t.style.position="absolute",t.style.left="0px",t.style.top="0px",t}}),exports.Dialog=Dialog,Dialog.prototype.open=function(e,t,n){var r,i=this.element,o=(e||this.view).render(i);i.style.width=(this.width||t)+"px",i.style.height=(this.height||n)+"px","function"==typeof this.openCallback&&this.openCallback.call(this.openContext||this,this),o&&(o instanceof Node?i.appendChild(o):"string"==typeof o&&(r=document.createElement("div"),r.innerHTML=o,i.appendChild(r.firstElementChild)))},exports.Box=Box,mix(Box,Adjustable),mix(Box,ElementWrapper),mix(Box,ParentElementWrapper),mix(Box,Layout),mix(Box,Serializer),mix(Box,EventEmitter),Box.prototype.addDecorator=function(e){return this._decorators.push(e),this},Box.prototype.getDecorators=function(){return this._decorators},Box.prototype.getFlowDirection=function(){return this._flowDirection},Box.prototype.setFlowDirection=function(e){this._flowDirection=e||Box.FLOW_HORIZONTAL},Box.prototype.setWidthDimension=function(e){this.width=new Dimension(e)},Box.prototype.setHeightDimension=function(e){this.height=new Dimension(e)},Box.prototype.addChild=function(e,t,n){var r=new Box(e,t,this.getElement());return this.addBox(r,n)},Box.prototype.addBox=function(e,t){if(!(e instanceof Box))throw new TypeError("Argument is not a Box!");return e.setParentElement(this.getElement()),this.getChildren()[t||e.getId()]=e,e},Box.prototype.getName=function(){return this._name},Box.prototype.setName=function(e){if(Box._nameRegistry[e])throw"Box name already exists: "+e;this._name=e,Box._nameRegistry[e]=this.getId()},Box.prototype.getId=function(){return this._id},Box.prototype.getChild=function(e){return this.getChildren()[e]},Box.prototype.getChildren=function(){return this._children},Box.prototype.getChildCount=function(){return Object.keys(this.getChildren()).length},Box.prototype.removeChild=function(e){var t=this.getChildren();t[e].close(),delete t[e]},Box.prototype.render=function(){var e,t=this.getParentElement(),n=t.getAttribute("data-box-id"),r=Box.getById(n),i=EventEmitter.ON_RENDER;r instanceof Box&&(e=r.getFlowDirection()),BoxRenderer.render(this,t,e),this.isRendered?i=EventEmitter.ON_UPDATE:this.isRendered=!0,this.emit(i)},Box.MIN_DIMENSION="100px",Box.FLOW_VERTICAL="vertical",Box.FLOW_HORIZONTAL="horizontal",Box._registry={},Box._nameRegistry={},Box.REG_PREFIX="bbox_",Box._id=0,Box.generateUniqueBoxId=function(){return Box.REG_PREFIX+Box._id++},Box.removeBox=function(e){delete Box._registry[e]},Box.getById=function(e){return Box._registry[e]},Box.getByName=function(e){var t=Box._nameRegistry[e];return t?Box._registry[t]:null},Box.clean=function(){Box._id=0,Box._registry={}}}).call(this);